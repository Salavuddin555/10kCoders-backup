<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <table border="1">
      <thead>
        <tr>
          <th>id</th>
          <th>userId</th>
          <th>date</th>
          <th>products</th>
          <th>__V</th>
        </tr>
        <tbody>

        </tbody>
      </thead>
    </table>
    <script>
      var users = [
        {
          id: 1,
          userId: 1,
          date: "2020-03-02T00:00:02.000Z",
          products: [
            { productId: 1, quantity: 4 },
            { productId: 2, quantity: 1 },
            { productId: 3, quantity: 6 },
          ],
          __v: 0,
        },
        {
          id: 2,
          userId: 1,
          date: "2020-01-02T00:00:02.000Z",
          products: [
            { productId: 2, quantity: 4 },
            { productId: 1, quantity: 10 },
            { productId: 5, quantity: 2 },
          ],
          __v: 0,
        },
        {
          id: 3,
          userId: 2,
          date: "2020-03-01T00:00:02.000Z",
          products: [
            { productId: 1, quantity: 2 },
            { productId: 9, quantity: 1 },
          ],
          __v: 0,
        },
        {
          id: 4,
          userId: 3,
          date: "2020-01-01T00:00:02.000Z",
          products: [{ productId: 1, quantity: 4 }],
          __v: 0,
        },
        {
          id: 5,
          userId: 3,
          date: "2020-03-01T00:00:02.000Z",
          products: [
            { productId: 7, quantity: 1 },
            { productId: 8, quantity: 1 },
          ],
          __v: 0,
        },
        {
          id: 6,
          userId: 4,
          date: "2020-03-01T00:00:02.000Z",
          products: [
            { productId: 10, quantity: 2 },
            { productId: 12, quantity: 3 },
          ],
          __v: 0,
        },
        {
          id: 6,
          userId: 8,
          date: "2020-03-01T00:00:02.000Z",
          products: [{ productId: 18, quantity: 1 }],
          __v: 0,
        },
      ];
      var filteredUser=[]
       function displayUsers(users){
        document.querySelector("tbody").innerHTML=""
        users.forEach((user,i)=>{
          var myTr=document.createElement("tr");
          for(a in user){
            var myTd=document.createElement("td")
            if(a!=="products" && a!=="__V"){
              
              myTd.innerHTML=user[a]
              myTr.appendChild(myTd)
            }else if(a=="products"){
              var myTable=document.createElement("table")
              user[a].forEach((us,i)=>{
                var myTr1=document.createElement("tr")
                for(c in us){
                  var myTd1=document.createElement("td")
                  myTd1.innerHTML=c+":"+us[c]
                  myTr1.appendChild(myTd1)
                }
                myTable.appendChild(myTr1)
              })
              myTd.appendChild(myTable)
              myTr.appendChild(myTd)
            }
          }
          myDelTd=document.createElement("td")
          myBtn=document.createElement("button")
          myBtn.innerHTML="Delete"
          myBtn.setAttribute("onclick","userDelete("+ i +")")
          myDelTd.appendChild(myBtn)
          myTr.appendChild(myDelTd)
          document.querySelector("tbody").appendChild(myTr)
        })
      }
      function userDelete(i){
            console.log("Delete done for the index : ", i)
            if (filteredUser.length == 0) {
              filteredUser = users.filter((user, index) => {
                    return  user.id !== users[i].id;
                })
            }
            else {
              filteredUser = filteredUser.filter((user, index) => {
                    return  user.id !== filteredUser[i].id;
                })
            }
            displayUsers(filteredUser);
        }
        displayUsers(users);
    </script>
  </body>
</html>
